# CBCanvas Node - Enhanced Features

## 🎨 Overview

CBCanvas Enhanced는 **fabric.js** 기반의 고급 캔버스 노드입니다. 브러쉬, 지우개, 레이어, 이미지 transform을 지원합니다.

## ✨ 주요 기능

### 1. **브러쉬 툴** ✏️
- **크기 조절**: 1~50px 슬라이더
- **색상 선택**: RGB 컬러 피커
- **부드러운 그리기**: Pencil Brush 엔진
- **실시간 미리보기**: 그리는 즉시 표시

### 2. **지우개 툴** 🧹
- **알파 채널 지원**: 투명하게 지우기
- **크기 조절**: 브러쉬와 동일한 슬라이더
- **EraserBrush**: fabric.js의 전문 지우개
- **정밀 제어**: 픽셀 단위 정확도

### 3. **선택/이동 툴** ↖️
- **오브젝트 선택**: 그림, 이미지 선택 가능
- **이동**: 드래그로 자유롭게 이동
- **회전**: 핸들로 회전
- **크기 조절**: 코너 핸들로 확대/축소
- **비율 유지**: Shift 키로 비율 고정

### 4. **이미지 추가** 📁
- **파일 업로드**: 로컬 이미지 추가
- **알파 채널 보존**: PNG 투명도 완벽 지원
- **자동 스케일**: 캔버스에 맞게 자동 조절
- **중앙 정렬**: 추가 시 자동 중앙 배치
- **Transform 지원**: 이동, 회전, 크기 조절 가능

### 5. **레이어 시스템**
- **다중 오브젝트**: 여러 그림/이미지 동시 관리
- **Z-Index**: 앞/뒤 순서 조절 가능
- **선택적 편집**: 개별 오브젝트 선택 편집
- **그룹화**: 여러 오브젝트 그룹 관리

### 6. **캔버스 관리**
- **Clear All** 🗑️: 모든 내용 삭제
- **저장/불러오기**: 워크플로우에 자동 저장
- **비율 조절**: 실시간 캔버스 리사이즈
- **내용 보존**: 리사이즈 시 내용 유지

## 🎯 사용법

### 기본 그리기
1. **Brush** 툴 선택 (기본 활성)
2. Size 슬라이더로 크기 조절
3. Color 피커로 색상 선택
4. 캔버스에 드래그하여 그리기

### 지우개 사용
1. **Eraser** 툴 선택
2. Size 슬라이더로 지우개 크기 조절
3. 캔버스에서 드래그하여 지우기
4. 알파 채널이 투명하게 제거됨

### 이미지 추가 및 편집
1. **📁 Add Image** 버튼 클릭
2. 이미지 파일 선택 (PNG, JPG 등)
3. **Select/Move** 툴로 전환
4. 이미지 선택 → 이동/회전/크기조절

### 캔버스 비율 변경
1. `aspect_ratio_slider` 조절 (-6 ~ +6)
2. 캔버스가 즉시 리사이즈됨
3. 기존 내용이 자동으로 스케일 조절됨

## 🖼️ 이미지 Transform 상세

### 알파 채널 지원
- **PNG 투명도**: 완벽 보존
- **WebP 알파**: 지원
- **GIF 투명**: 지원
- **JPG**: 불투명 배경

### Transform 기능
```
선택 상태에서:
- 드래그: 이동
- 코너 핸들: 크기 조절
- 회전 핸들: 회전
- Shift + 드래그: 비율 유지
- Delete 키: 오브젝트 삭제
```

### 다중 선택
- Shift + 클릭으로 여러 오브젝트 선택
- 그룹으로 이동/회전/크기조절 가능

## 🛠️ 기술 사양

### Fabric.js 기능
```javascript
- Canvas: 메인 캔버스 관리
- PencilBrush: 자연스러운 그리기
- EraserBrush: 알파 채널 지우기
- Image.fromURL: 이미지 로드
- toJSON/fromJSON: 저장/불러오기
- toDataURL: PNG 내보내기
```

### 해상도
| 비율 | 실제 크기 | 표시 크기 (max 500px) |
|------|----------|----------------------|
| 21:9 | 1536x640 | 500x208 |
| 16:9 | 1344x768 | 500x285 |
| 1:1 | 1024x1024 | 500x500 |
| 9:16 | 768x1344 | 286x500 |
| 9:21 | 640x1536 | 208x500 |

### 내보내기
- **Format**: PNG with alpha
- **Quality**: 1.0 (최고 품질)
- **Multiplier**: 1x (실제 해상도)
- **Output**: Base64 DataURL

## 🎨 UI 컴포넌트

### 툴바 (Toolbar)
```
[✏️ Brush] [🧹 Eraser] [↖️ Select/Move] [🗑️ Clear All]
[Size: 5 ────○──────]  [Color: ■]
```

### 정보 라벨
```
Ratio: 1:1 (1024x1024) - Display: 500x500
```

### 버튼
- **📁 Add Image**: 이미지 파일 업로드
- **Clear All**: 전체 삭제 (확인 대화상자)

## 💾 저장 시스템

### 자동 저장
- 워크플로우 저장 시 자동으로 캔버스 저장
- JSON 형식으로 오브젝트 구조 저장
- Base64 PNG로 이미지 스냅샷 저장

### 불러오기
- 워크플로우 로드 시 자동 복원
- 모든 오브젝트와 속성 복원
- 알파 채널 완벽 보존

## 🔧 고급 설정

### 브러쉬 커스터마이징
```javascript
// 기본 설정
brushSize: 5 (1-50)
brushColor: "#000000"
eraserSize: 5 (1-50)
```

### 캔버스 설정
```javascript
// Fabric.js 옵션
backgroundColor: "#ffffff"
enableRetinaScaling: true
selection: true/false (툴에 따라)
```

## 📝 단축키 (계획)

현재 단축키는 없지만 추가 예정:
- `B`: Brush 툴
- `E`: Eraser 툴
- `V`: Select 툴
- `Delete`: 선택 오브젝트 삭제
- `Ctrl+Z`: Undo (예정)
- `Ctrl+Y`: Redo (예정)

## 🚀 성능 최적화

### Retina 지원
- `enableRetinaScaling: true`
- 고해상도 디스플레이 최적화

### 메모리 관리
- 노드 제거 시 `canvas.dispose()` 호출
- 이벤트 리스너 자동 정리

### 렌더링
- 필요할 때만 `renderAll()` 호출
- 효율적인 오브젝트 관리

## 🐛 알려진 이슈

1. **EraserBrush**: fabric.js 버전에 따라 지원 안 될 수 있음
2. **대용량 이미지**: 메모리 사용량 증가 가능
3. **Undo/Redo**: 아직 구현 안 됨 (추가 예정)

## 🔮 향후 계획

- [ ] Undo/Redo 시스템
- [ ] 레이어 패널 UI
- [ ] 더 많은 브러쉬 타입
- [ ] 도형 그리기 툴
- [ ] 텍스트 추가 기능
- [ ] 필터/효과 시스템
- [ ] 단축키 지원
